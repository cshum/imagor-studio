type Query {
    listFiles(
        path: String!
        offset: Int!
        limit: Int!
        onlyFiles: Boolean
        onlyFolders: Boolean
        sortBy: SortOption
        sortOrder: SortOrder
    ): FileList!

    statFile(path: String!): FileStat

    # Registry APIs
    listUserRegistry(prefix: String, ownerID: String): [UserRegistry!]!
    getUserRegistry(key: String!, ownerID: String): UserRegistry
    listSystemRegistry(prefix: String): [SystemRegistry!]!
    getSystemRegistry(key: String!): SystemRegistry

    me: User

    # admin only operations
    user(id: ID!): User
    users(offset: Int = 0, limit: Int = 20): UserList!
}

type Mutation {
    # write scope required
    uploadFile(path: String!, content: Upload!): Boolean!
    deleteFile(path: String!): Boolean!
    createFolder(path: String!): Boolean!

    # self operations, or admin scope with userId
    updateProfile(input: UpdateProfileInput!, userId: ID): User!
    changePassword(input: ChangePasswordInput!, userId: ID): Boolean!
    deactivateAccount(userId: ID): Boolean!

    # User Registry APIs
    setUserRegistry(entries: [RegistryEntryInput!]!, ownerID: String): [UserRegistry!]!
    deleteUserRegistry(key: String!, ownerID: String): Boolean!

    # System Registry APIs (admin only for write)
    setSystemRegistry(entries: [RegistryEntryInput!]!): [SystemRegistry!]!
    deleteSystemRegistry(key: String!): Boolean!

    # admin only operations
    createUser(input: CreateUserInput!): User!
}

type User {
    id: ID!
    displayName: String!
    email: String!
    role: String!
    isActive: Boolean!
    createdAt: String!
    updatedAt: String!
}

type UserList {
    items: [User!]!
    totalCount: Int!
}

input UpdateProfileInput {
    displayName: String
    email: String
}

input ChangePasswordInput {
    currentPassword: String  # Optional when admin is changing another user's password
    newPassword: String!
}

input CreateUserInput {
    displayName: String!
    email: String!
    password: String!
    role: String!
}

input RegistryEntryInput {
    key: String!
    value: String!
    isEncrypted: Boolean!
}

# Existing types...
type FileList {
    items: [FileItem!]!
    totalCount: Int!
}

type FileItem {
    name: String!
    path: String!
    size: Int!
    isDirectory: Boolean!
    thumbnailUrls: ThumbnailUrls
}

type ThumbnailUrls {
  grid: String
  preview: String
  full: String
  original: String
  meta: String
}

type FileStat {
    name: String!
    path: String!
    size: Int!
    isDirectory: Boolean!
    modifiedTime: String!
    etag: String
}

enum SortOption {
    NAME
    SIZE
    MODIFIED_TIME
}

enum SortOrder {
    ASC
    DESC
}

scalar Upload

type UserRegistry {
    key: String!
    value: String!
    ownerID: String!
    isEncrypted: Boolean!
    createdAt: String!
    updatedAt: String!
}

type SystemRegistry {
    key: String!
    value: String!
    ownerID: String!
    isEncrypted: Boolean!
    createdAt: String!
    updatedAt: String!
    isOverriddenByConfig: Boolean!
}

scalar JSON
